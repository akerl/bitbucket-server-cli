#!/usr/bin/env ruby

require 'rubygems'
#require File.dirname(__FILE__) + "/../lib/stash_cli"
require 'stash_cli'
require 'commander/import'

program :name, "Atlassian Stash CLI"
program :version, Atlassian::Stash::Version::STRING
program :description, "Provides convenient functions for interacting with Atlassian Stash through the command line"

include Atlassian::Stash
include Atlassian::Stash::Git


command 'pull-request' do |c|
  c.syntax = 'pull-request source target'
  c.description = 'Create a pull request in Stash'
  c.example 'stash pull-request topicBranch master', "Creates a pull request from branch 'topicBranch' into 'master'"
  c.action do |args, options|
    source, target, *rest = args
    raise "Please provide the name of the source and target ref" unless source && target
    ensure_within_git! do
      cpr = CreatePullRequest.new
      cpr.create_pull_request source, target
    end
  end
end



# vim set ft=ruby
